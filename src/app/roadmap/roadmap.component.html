<div class="road-container" (click)="closeTooltip()">
  <div class="svg-wrapper" #svgContainer></div>

  <svg *ngIf="points.length" viewBox="0 0 1000 400" class="overlay">
    <ng-container *ngFor="let p of points">
      <!-- نقاط مراحل -->
      <circle
        *ngIf="p.type === 'step'"
        [attr.cx]="p.x"
        [attr.cy]="p.y - 5"
        r="5"
        fill="#ccc"
        stroke="#222"
        stroke-width="1"
      ></circle>

      <!-- هدف اصلی -->
      <g
        *ngIf="p.type === 'goal' && p.goalIndex === mainGoalIndex"
        (click)="openTooltip(p.goalIndex, $event)"
      >
        <image
          [attr.x]="p.x - 25"
          [attr.y]="p.y - 35"
          width="50"
          height="50"
          href="assets/point 3.svg"
        ></image>

        <foreignObject
          *ngIf="tooltipGoal === mainGoalIndex"
          [attr.x]="p.x - 80"
          [attr.y]="p.y - 100"
          width="160"
          height="80"
        >
          <div xmlns="http://www.w3.org/1999/xhtml" class="tooltip-box">
            <strong>{{ roadmap[p.goalIndex].title }}</strong><br />
            آخرین مرحله:
            {{
              roadmap[p.goalIndex].steps[roadmap[p.goalIndex].steps.length - 1]
                .name
            }}<br />
            درصد پیشرفت: {{ progressPercent }}٪
          </div>
        </foreignObject>
      </g>

      <!-- سایر اهداف -->
      <circle
        *ngIf="p.type === 'goal' && p.goalIndex !== mainGoalIndex"
        [attr.cx]="p.x"
        [attr.cy]="p.y - 5"
        r="12"
        fill="red"
        stroke="#550000"
        stroke-width="2"
      ></circle>
    </ng-container>
  </svg>
</div>
