<div class="road-container">
  <div class="svg-wrapper" #svgContainer></div>

  <svg
    *ngIf="points.length > 0"
    viewBox="0 0 1000 400"
    xmlns="http://www.w3.org/2000/svg"
    class="overlay"
    preserveAspectRatio="xMidYMid meet"
  >
    <ng-container *ngFor="let point of points">
      <!-- مراحل -->
      <circle
        *ngIf="point.isStep"
        [attr.cx]="point.x"
        [attr.cy]="point.y"
        r="6"
        [attr.fill]="getStepColor(point.stepDone, !!point.isLocked)"
        stroke="#2b2b2b"
        stroke-width="2"
        (click)="toggleTooltip(point)"
      ></circle>

      <!-- اهداف -->
      <circle
        *ngIf="!point.isStep"
        [attr.cx]="point.x"
        [attr.cy]="point.y"
        r="12"
        [attr.fill]="getColor(point.progress, !!point.isLocked)"
        stroke="#2b2b2b"
        stroke-width="3"
        (click)="toggleTooltip(point)"
        [attr.opacity]="0"
      ></circle>
      <image
  *ngIf="!point.isStep"
  [attr.x]="point.x - 20"
  [attr.y]="point.y - 20"
  width="40"
  height="40"
  [attr.href]="'assets/point 3.svg'"
  (click)="toggleTooltip(point)"
></image>

      <!-- Tooltip -->
      <g *ngIf="hoveredPoint?.id === point.id">
        <rect
          [attr.x]="point.x - 70"
          [attr.y]="point.y + 20"
          rx="6"
          ry="6"
          width="140"
          height="60"
          fill="#2b2b2b"
          stroke="#444"
          stroke-width="1"
        ></rect>

        <text
          [attr.x]="point.x"
          [attr.y]="point.y + 40"
          text-anchor="middle"
          fill="#fff"
          font-size="12"
          font-family="sans-serif"
        >
          {{ point.isStep ? point.label : point.label + ' - ' + point.progress + '%' }}
        </text>

        <foreignObject
          *ngIf="point.isStep"
          [attr.x]="point.x - 60"
          [attr.y]="point.y + 45"
          width="120"
          height="30"
        >
          <div xmlns="http://www.w3.org/1999/xhtml" class="tooltip-checkbox">
            <label>
              <input
                type="checkbox"
                [checked]="point.stepDone"
                (click)="$event.stopPropagation()"
                (change)="toggleStep(point)"
              />
              انجام شد
            </label>
          </div>
        </foreignObject>
      </g>
    </ng-container>
  </svg>
</div>
